<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/head') %>
    <title>Business Model Setup</title>
    <link rel="stylesheet" href="/styles/businessModel.css">
</head>
<body>
    <div class="container">
        
        <main>
           

            <div class="business-model-container">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-button active" data-tab="staff-section">
                        <i class="bi bi-people-fill"></i>
                        Staff
                    </button>
                    <button class="tab-button" data-tab="categories-section">
                        <i class="bi bi-grid-1x2-fill"></i>
                        Categories
                    </button>
                    <button class="tab-button" data-tab="services-section">
                        <i class="bi bi-bag-check-fill"></i>
                        Services
                    </button>
                    <button class="tab-button" data-tab="hours-section">
                        <i class="bi bi-clock-fill"></i>
                        Business Hours
                    </button>
                    <button class="tab-button" data-tab="delivery-section">
                        <i class="bi bi-truck"></i>
                        Service Delivery
                    </button>
                    <button class="tab-button" data-tab="branches-section">
                        <i class="bi bi-building"></i>
                        Branches
                    </button>
                </div>
                
                <!-- Existing sections with tab-content class added -->
                <div class="tab-content">
                    <section class="model-section active" id="staff-section">
                        <h2>Staff Management</h2>
                        <div class="staff-wrapper">
                            <div class="add-staff">
                                <form id="staffForm" action="/admin/add-staff" method="POST">
                                    <div class="form-group">
                                        <input type="text" 
                                               name="staffName" 
                                               placeholder="Staff Name" 
                                               required>
                                        <input type="text" 
                                               name="position" 
                                               placeholder="Position (optional)">
                                        <button type="submit" class="btn-primary">Add Staff</button>
                                    </div>
                                </form>
            </div>

                            <div class="staff-list">
                                <% if (staffMembers && staffMembers.length > 0) { %>
                                    <% staffMembers.forEach(staff => { %>
                                        <div class="staff-card">
                                            <div class="staff-info">
                                                <h3><%= staff.name %></h3>
                                                <p><%= staff.position || 'Position not specified' %></p>
            </div>
                </div>
                                    <% }) %>
                                <% } else { %>
                                    <p class="no-data">No staff members added yet</p>
                                <% } %>
                    </div>
                </div>
                    </section>

                    <section class="model-section" id="categories-section">
                        <h2>Service Categories</h2>
                        <div class="categories-wrapper">
                            <div class="add-category">
                                <form id="categoryForm" action="/admin/add-category" method="POST">
                                    <div class="form-group">
                                        <input type="text" name="categoryName" placeholder="Category Name" required>
                                        <textarea name="categoryDescription" placeholder="Category Description"></textarea>
                                        <button type="submit" class="btn-primary">Add Category</button>
                                    </div>
                                </form>
                            </div>
                            <div class="categories-list">
                                <% if (categories && categories.length > 0) { %>
                                    <% categories.forEach(category => { %>
                                        <div class="category-card" data-id="<%= category.id %>">
                                            <h3><%= category.name %></h3>
                                            <p><%= category.description %></p>
                                            <button class="btn-secondary add-service-btn">Add Service</button>
                                    </div>
                                    <% }) %>
                                <% } else { %>
                                    <p class="no-data">No categories added yet</p>
                                <% } %>
                            </div>
                        </div>
                    </section>

                    <section class="model-section" id="services-section">
                        <h2>Services</h2>
                        <div class="services-wrapper">
                            <!-- Updated Service Add Form -->
<form id="serviceForm" action="/admin/add-service" method="POST" enctype="multipart/form-data">
    <div class="form-group">
        <select name="categoryId" required>
            <option value="">Select Category</option>
            <% if (categories) { %>
                <% categories.forEach(category => { %>
                    <option value="<%= category.id %>"><%= category.name %></option>
                <% }) %>
            <% } %>
        </select>
        
        <input type="text" name="serviceName" placeholder="Service Name" required>
        
        <textarea name="serviceDescription" placeholder="Service Description"></textarea>
        
        <div class="service-details">
            <input type="number" name="price" placeholder="Price" required min="0" step="0.01">
            <input type="number" name="duration" placeholder="Duration (minutes)" required min="15">
            
            <!-- Replace staff count with multi-select dropdown -->
            <select name="staffIds" multiple required>
                <option value="">Select Staff Members</option>
                <% if (staffMembers) { %>
                    <% staffMembers.forEach(staff => { %>
                        <option value="<%= staff.id %>"><%= staff.name %></option>
                    <% }) %>
                <% } %>
            </select>
                        </div>

        <div class="image-upload">
            <label for="serviceImages">Service Images</label>
            <input type="file" name="serviceImages" multiple accept="image/*">
                        </div>

        <button type="submit" class="btn-primary">Add Service</button>
    </div>
</form>
                        </div>
                    </section>

                    <section class="model-section" id="hours-section">
                        <h2>Business Hours</h2>
                        <form id="scheduleForm" action="/admin/save-schedule" method="POST">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Day</th>
                                            <th>Open</th>
                                            <th>Close</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']; %>
                                        <% days.forEach((day, index) => { %>
                                        <tr>
                                            <td><%= day %></td>
                                            <td>
                                                <select name="openTime_<%= index %>" class="form-select time-select">
                                                    <% for(let h = 0; h < 24; h++) { %>
                                                        <% for(let m = 0; m < 60; m += 30) { %>
                                                            <% 
                                                                const hour = h.toString().padStart(2, '0');
                                                                const min = m.toString().padStart(2, '0');
                                                                const time = `${hour}:${min}`;
                                                            %>
                                                            <option value="<%= time %>"><%= time %></option>
                                                        <% } %>
                                                    <% } %>
                                                </select>
                                            </td>
                                            <td>
                                                <select name="closeTime_<%= index %>" class="form-select time-select">
                                                    <% for(let h = 0; h < 24; h++) { %>
                                                        <% for(let m = 0; m < 60; m += 30) { %>
                                                            <% 
                                                                const hour = h.toString().padStart(2, '0');
                                                                const min = m.toString().padStart(2, '0');
                                                                const time = `${hour}:${min}`;
                                                            %>
                                                            <option value="<%= time %>" <%= time === '18:00' ? 'selected' : '' %>><%= time %></option>
                                                        <% } %>
                                                    <% } %>
                                                </select>
                                            </td>
                                            <td>
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" name="isOpen_<%= index %>" id="isOpen_<%= index %>" checked>
                                                    <label class="form-check-label text-success day-status" for="isOpen_<%= index %>">Open</label>
                                                </div>
                                            </td>
                                        </tr>
                                        <% }); %>
                                    </tbody>
                                </table>
                    </div>

                            <div class="text-end mt-3">
                                <button type="submit" class="btn btn-primary">Save Schedule</button>
                                        </div>
                        </form>
                    </section>

                    <section class="model-section" id="delivery-section">
                        <h2>Service Delivery</h2>
                        <form id="deliveryForm" action="/admin/update-delivery" method="POST">
                            <div class="delivery-options">
                                <div class="form-group">
                                    <label>Service Type</label>
                                    <select name="serviceType" required>
                                        <option value="store-based" <%= business?.service_type === 'store-based' ? 'selected' : '' %>>Store Based</option>
                                        <option value="mobile" <%= business?.service_type === 'mobile' ? 'selected' : '' %>>Mobile Service</option>
                                        <option value="both" <%= business?.service_type === 'both' ? 'selected' : '' %>>Both</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn-primary">Update Delivery Options</button>
                        </form>
                    </section>

                    <section class="model-section" id="branches-section">
                        <h2>Branch Management</h2>
                        <form id="branchForm" action="/admin/add-branch" method="POST">
                            <div class="form-group">
                                <input type="text" 
                                       name="branchName" 
                                       placeholder="Branch Name" 
                                       required>
                                <input type="text" 
                                       name="address" 
                                       placeholder="Branch Address" 
                                       required>
                                <input type="tel" 
                                       name="telephone" 
                                       placeholder="Branch Telephone">
                                <label>
                                    <input type="checkbox" 
                                           name="isPrimary" 
                                           value="true"> Set as Primary Branch
                                </label>
                                <button type="submit" class="btn-primary">Add Branch</button>
                            </div>
                        </form>

                        <div class="branches-list">
                            <% if (branches && branches.length > 0) { %>
                                <% branches.forEach(branch => { %>
                                    <div class="branch-card">
                                        <h3><%= branch.name %></h3>
                                        <p><%= branch.address %></p>
                                        <p><%= branch.telephone %></p>
                                        <% if (branch.is_primary) { %>
                                            <span class="primary-badge">Primary Branch</span>
                                        <% } %>
                                    </div>
                                <% }) %>
                            <% } else { %>
                                <p class="no-data">No branches added yet</p>
                            <% } %>
                        </div>
                    </section>
                    </div>
            </div>
        </main>
    </div>

    <script src="/js/businessModel.js"></script>
</body>
</html> 